<script>
  // Read params from URL
  const urlParams = new URLSearchParams(window.location.search);
  const managerName = urlParams.get("manager");
  const outletName = urlParams.get("outlet");

  // Save manager in localStorage if provided
  if (managerName) {
    localStorage.setItem("managerName", managerName);
  }

  const savedManager = localStorage.getItem("managerName");

  // Clean the URL AFTER the DOM is loaded
  window.addEventListener("load", () => {
    if (managerName || outletName) {
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  });

  // If outlet is tapped but no manager stored → show warning
  if (outletName && !savedManager) {
    document.getElementById("warning").style.display = "block";
  }

  // If we have both manager + outlet → load Jotform
  if (outletName && savedManager) {
    const iframe = document.getElementById("jotformFrame");
    iframe.style.display = "block";
    iframe.src = "https://form.jotform.com/251891698588077";

    iframe.onload = () => {
      try {
        const innerDoc = iframe.contentDocument || iframe.contentWindow.document;
        const nameField = innerDoc.querySelector("#input13");
        const outletField = innerDoc.querySelector("#input14");

        if (nameField) nameField.value = savedManager;
        if (outletField) outletField.value = outletName;
      } catch (e) {
        console.error("Injection error:", e);
      }
    };
  }
</script>

