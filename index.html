<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Dining Clock-In</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
    .hidden { display: none; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2 id="status">Loading...</h2>
  <div id="browserChoice" class="hidden">
    <p>Select which browser you want to use for clock-in:</p>
    <button onclick="saveBrowser('Chrome')">Chrome</button>
    <button onclick="saveBrowser('Safari')">Safari</button>
    <button onclick="saveBrowser('Edge')">Edge</button>
    <button onclick="saveBrowser('Firefox')">Firefox</button>
  </div>
  <div>
    <button onclick="resetBrowser()">Reset Browser</button>
  </div>

  <script>
    const jotformURL = "https://form.jotform.com/251891698588077";

    const urlParams = new URLSearchParams(window.location.search);
    const managerFromLink = urlParams.get("manager");
    const outletFromLink = urlParams.get("outlet");

    const savedBrowser = localStorage.getItem("preferredBrowser");
    const savedManager = localStorage.getItem("managerName");

    const status = document.getElementById("status");
    const browserChoice = document.getElementById("browserChoice");

    function redirectToJotform(manager, outlet) {
      const params = new URLSearchParams({
        name: manager || "",
        outlet: outlet || ""
      });
      window.location.href = jotformURL + "?" + params.toString();
    }

    function saveBrowser(choice) {
      localStorage.setItem("preferredBrowser", choice);
      status.innerText = "Browser saved (" + choice + "). Please tap NFC tag again.";
      browserChoice.classList.add("hidden");
    }

    function resetBrowser() {
      localStorage.removeItem("preferredBrowser");
      localStorage.removeItem("managerName");
      status.innerText = "Browser reset. Please click your manager link again to choose.";
    }

    // --- Main Logic ---
    if (managerFromLink) {
      // Manager clicked personal link
      localStorage.setItem("managerName", managerFromLink);
      if (savedBrowser) {
        // If outlet also present, redirect directly
        if (outletFromLink) {
          redirectToJotform(managerFromLink, outletFromLink);
        } else {
          status.innerText = "Manager saved. Please tap NFC tag to clock in.";
        }
      } else {
        status.innerText = "Please select your preferred browser for clock-in.";
        browserChoice.classList.remove("hidden");
      }
    } else if (outletFromLink) {
      // Outlet NFC tapped
      if (!savedManager) {
        status.innerText = "⚠️ Manager not set. Please click your manager link first.";
      } else if (!savedBrowser) {
        status.innerText = "Please click your manager link in this browser to set browser preference.";
      } else {
        redirectToJotform(savedManager, outletFromLink);
      }
    } else {
      status.innerText = "Invalid access. Please tap NFC tag or click manager link.";
    }
  </script>
</body>
</html>
