<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SuperDining NFC Clock-In</title>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const params = new URLSearchParams(window.location.search);
      const manager = params.get("manager");
      const outlet = params.get("outlet");

      // 1. Save manager into localStorage
      if (manager) {
        localStorage.setItem("managerName", manager);
        document.body.innerHTML = `<h2>✅ Manager saved: ${manager}. You can now tap an outlet NFC tag.</h2>`;
        return;
      }

      // 2. If outlet NFC is tapped
      if (outlet) {
        const savedManager = localStorage.getItem("managerName");

        if (!savedManager) {
          document.body.innerHTML = `<h2>⚠️ Please save manager info first before tapping outlet tag.</h2>`;
          return;
        }

        // 3. Auto-submit hidden form to JotForm (POST method)
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "https://form.jotform.com/251891698588077";

        const nameField = document.createElement("input");
        nameField.type = "hidden";
        nameField.name = "name";
        nameField.value = savedManager;

        const outletField = document.createElement("input");
        outletField.type = "hidden";
        outletField.name = "outlet";
        outletField.value = outlet;

        form.appendChild(nameField);
        form.appendChild(outletField);
        document.body.appendChild(form);
        form.submit();

        return;
      }

      // 4. If no manager/outlet in URL
      document.body.innerHTML = `<h2>Welcome. Please use your manager link first or tap an outlet NFC tag.</h2>`;
    });
  </script>
</head>
<body>
</body>
</html>
