<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Dining Clock-In</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #status { text-align:center; padding:20px; font-size:18px; color:#444; }
    iframe { width:100%; height:100vh; border:none; display:none; }
  </style>
</head>
<body>
  <h2 id="status">Loading...</h2>
  <iframe id="jotformFrame"></iframe>

  <script>
    const jotformURL = "https://form.jotform.com/251891698588077";
    const urlParams = new URLSearchParams(window.location.search);
    const outletFromLink = urlParams.get("outlet");
    const managerFromCache = localStorage.getItem("managerName");

    const status = document.getElementById("status");
    const iframe = document.getElementById("jotformFrame");

    if (!managerFromCache) {
      status.innerText = "⚠️ Manager not saved. Please click your manager link first.";
    } else if (!outletFromLink) {
      status.innerText = "⚠️ No outlet detected. Please tap NFC tag.";
    } else {
      // Hide status & show form
      status.style.display = "none";
      iframe.style.display = "block";
      iframe.src = jotformURL;

      // Listen for form ready event
      window.addEventListener("message", function(e) {
        if (e.data && e.data.type === "jfEvent" && e.data.eventName === "formReady") {
          iframe.contentWindow.postMessage({
            "type": "setFieldsValue",
            "value": {
              "name": managerFromCache,
              "outlet": outletFromLink
            }
          }, "*");
        }
      });
    }
  </script>
</body>
</html>




